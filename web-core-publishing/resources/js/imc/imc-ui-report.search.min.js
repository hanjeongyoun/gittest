$.widget("imc.reportSearcher",{options:{height:"300px",startDateTitle:"시작일",endDateTitle:"종료일",searchTitle:"조회",timelyTitle:"시간",dailyTitle:"일",weeklyTitle:"주",monthlyTitle:"월",selectShow:!0,typeSelectShow:!1,useTimely:!0,excelDown:!1},_create:function(){this._createHtml(),this.element.append(this.range),this.element.append(this.locationArea),this.radio.find('input[type="radio"]').fakecheck(),this._bindEvent(),this.resetCalendar()},_createHtml:function(){this.options.useTimely?this.radio=$("<span>",{style:"margin-left: 20px"}).append($('<input type="radio" value="timely" name="range_type" id="timely"/><label for="timely">'+this.options.timelyTitle+"</label>")).append($('<input type="radio" value="daily" name="range_type" checked="checked" id="daily"/><label for="daily">'+this.options.dailyTitle+"</label>")).append($('<input type="radio" value="weekly" name="range_type" id="weekly"/><label for="weekly">'+this.options.weeklyTitle+"</label>")).append($('<input type="radio" value="monthly" name="range_type" id="monthly"/><label for="monthly">'+this.options.monthlyTitle+"</label>")):this.radio=$("<span>",{style:"margin-left: 20px"}).append($('<input type="radio" value="daily" name="range_type" checked="checked" id="daily"/><label for="daily">'+this.options.dailyTitle+"</label>")).append($('<input type="radio" value="weekly" name="range_type" id="weekly"/><label for="weekly">'+this.options.weeklyTitle+"</label>")).append($('<input type="radio" value="monthly" name="range_type" id="monthly"/><label for="monthly">'+this.options.monthlyTitle+"</label>")),this.range=$("<div>",{class:"function-area small"}).append($('<input type="text" class="search minimum calendar" id="start-date" style="width:130px;margin-left:0px !important;" placeholder="'+this.options.startDateTitle+'" readonly="readonly">')).append($('<input type="text" class="search minimum calendar" id="end-date" style="width:130px;" placeholder="'+this.options.endDateTitle+'" readonly="readonly">')).append($('<button type="button" class="btnf-search" id="btn-search">'+this.options.searchTitle+"</button>")).append($('<button type="button" class="btnf-reset minimum" id="btn-reset"></button>')).append(this.radio),this.drationTxt=$("<div>",{style:"margin-left:60% !important;"}).append($('<span id="dration" style="font-size:14px;padding-top:10px;"></span>')),this.select=$("<div>",{class:"left"}).append($('<select id="locId" data-searchkey="locId"></select>')),this.typeSelect=$("<div>",{class:"left",style:"margin-left:0px;"}).append($('<select id="reportType" data-searchkey="reportType"><option value="typeDetail">유형상세</option>\t<option value="indicatorsDetail">지표상세</option></select>')),this.locationArea=$("<div>",{class:"function-area small"}),this.options.selectShow&&this.locationArea.append(this.select),this.options.typeSelectShow&&(this.locationArea.append(this.typeSelect),this.typeSelect.find("select").fakeselect()),this.locationArea.append(this.drationTxt),this.options.selectShow&&Tag.selectBox.draw({selector:"#locId",firstTxt:"라인 전체",value:"locId",text:"locName",masterCd:"line",tableNm:"mdm_location"},$.proxy(function(){this.select.find("select").fakeselect()},this)),this.options.excelDown&&(this.excelButton=$('<button type="button" class="btnf-download" id="btn-excel-down" style="float: right;">엑셀 다운로드</button>'),this.drationTxt.append(this.excelButton))},_setOptions:function(e){this.options=$.extend({},this.options,e)},resetCalendar:function(){var e=new Date;e.setDate(e.getDate()-1),$("#start-date").datepicker("setDate",e),$("#end-date").datepicker("setDate",e)},_bindEvent:function(){var e=this.range.find("#start-date").datepicker(),t=this.range.find("#end-date").datepicker();e.on("change",function(){var e=$(this).datepicker("option","dateFormat"),a=$.datepicker.parseDate(e,this.value);t.datepicker("option","minDate",a)}),t.on("change",function(){var t=$(this).datepicker("option","dateFormat"),a=$.datepicker.parseDate(t,this.value);e.datepicker("option","maxDate",a)});var a=this;$("#btn-reset").click(function(){a.resetCalendar()}),$(".radio, span.radio+label").click(function(){"timely"===$(this).attr("for")||"0"===$(this).attr("data-fakeform-index")&&"timely"===$(this).prev().attr("id")?$("#end-date").hide():$("#end-date").show()})},setReportDuration:function(){var e="※ 집계 기간 : ",t="",a="";$("#start-date").val()&&(t=$("#start-date").val()),$("#end-date").val()&&(a=$("#end-date").val()),"timely"==$("input[name=range_type]:checked").val()?e+=t:"monthly"==$("input[name=range_type]:checked").val()?(e+=t.substring(0,t.length-3),e+=" ~ ",e+=a.substring(0,a.length-3)):(e+=t,e+=" ~ ",e+=a),e+=" | ",e+="조회일 : ";var i=new Date,n=i.getFullYear(),l="0"+(i.getMonth()+1),s="0"+i.getDate();n+="-"+l.slice(-2),e+=n+="-"+s.slice(-2),$("#dration").text(e)},getSearchParam:function(){var e,t="OK",a=$("#start-date").val(),i=$("#end-date").val(),n=$("#locId option:selected").val();e=this.options.typeSelectShow?$("#reportType option:selected").val():null;var l=$("input[name=range_type]:checked").val();0==a.length?(alert("시작일을 선택해주세요."),t="ERROR_StartDate"):"timely"!=l&&0==i.length&&(alert("종료일을 선택해주세요."),t="ERROR_EndDate");var s=new Date,o=s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate(),d=new Date(o+" 00:00:00"),r=new Date(a+" 00:00:00"),p=new Date(i+" 00:00:00");if((r>=d||p>=d)&&(alert("과거일자를 선택해주세요."),t="ERROR_Date"),"monthly"==l&&a.length>0&&i.length>0){var c=a.substring(0,8);a=c+"01";var h=i.substring(0,4),y=i.substring(5,7),m=new Date(h,y,0).getDate();i=new Date(h,y,m)>=d?h+"-"+y+"-"+(d.getDate()-1):h+"-"+y+"-"+m,$("#start-date").datepicker("setDate",new Date(c)),$("#end-date").datepicker("setDate",new Date(i))}return{startYyyymmdd:a,endYyyymmdd:i,gubun:l,locId:n,reportType:e,result:t}},_refresh:function(){this.resetCalendar()},_setOption:function(e,t){/isHeaderFix/.test(e)&&this.setFixHeader(t),/isFooterFix/.test(e)&&this.setFixFooter(t),/height/.test(e)&&this.body.css("height",t),this._super(e,t)},_destroy:function(){this.element.empty()}});